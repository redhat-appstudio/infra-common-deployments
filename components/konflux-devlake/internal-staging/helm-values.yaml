---
imageTag: v1.0.3-beta7

lake:
  image:
    repository: quay.io/konflux-ci/konflux-devprod/devlake-backend
    tag: 3b095ed861febca92a40260ba36f33926776d6f0
  encryptionSecret:
    secretName: konflux-devlake-secrets
    autoCreateSecret: false
  securityContext: {}
  containerSecurityContext: {}
  resources:
    requests:
      cpu: "2"
      memory: "4Gi"
    limits:
      memory: "8Gi"
  envs:
    REMOTE_PLUGIN_DIR: ""
    DISABLED_REMOTE_PLUGINS: "true"
    LOGGING_DIR: "/tmp"
    LOGGING_LEVEL: "info"
    IN_SECURE_SKIP_VERIFY: "true"
    PIPELINE_MAX_PARALLEL: "4"

    # API timeout - increase for large repositories with slow responses
    API_TIMEOUT: "180s"

    # API retry attempts for transient failures
    API_RETRY: "5"

    # ===========================================
    # GitHub GraphQL Job Collector (PR #8616)
    # Optimized for large repositories with many workflow jobs
    # ===========================================
    # PAGINATING mode: Queries one workflow run at a time with full pagination
    # - Guarantees complete data collection for workflows with >20 jobs
    # - More API calls but avoids timeouts and missing data
    GITHUB_GRAPHQL_JOB_COLLECTION_MODE: "PAGINATING"
    GITHUB_GRAPHQL_JOB_PAGINATING_PAGE_SIZE: "100"
  envFrom:
    - secretRef:
        name: konflux-devlake-secrets

mysql:
  useExternal: true
  externalServer: "kubernetes.default.svc.cluster.local"  # K8s API - always available
  externalPort: 443  # HTTPS port - always open

grafana:
  image:
    repository: quay.io/konflux-ci/konflux-devprod/devlake-dashboards
    tag: 14183f351068b428f67e686dc10f3f41cbc99cf7
  podSecurityContext: {}
  securityContext:
    fsGroup: null
    runAsGroup: null
    runAsUser: null
  initChownData:
    enabled: false
  envFromSecrets:
    - name: "konflux-devlake-secrets"
  env:
    TZ: "UTC"
    GF_SERVER_SERVE_FROM_SUBPATH: "true"
  grafana.ini:
    server:
      serve_from_subpath: "true"
      root_url: "${GF_SERVER_ROOT_URL}"
    auth.google:
      enabled: true
      client_id: "${GF_AUTH_GOOGLE_CLIENT_ID}"  # Set via secret
      client_secret: "${GF_AUTH_GOOGLE_CLIENT_SECRET}"  # Set via secret
      scopes: "https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email openid"
      auth_url: "https://accounts.google.com/o/oauth2/auth"
      token_url: "https://accounts.google.com/o/oauth2/token"
      api_url: "https://www.googleapis.com/oauth2/v1/userinfo"
      allowed_domains: "redhat.com"
      allow_sign_up: true
      auto_login: false
ui:
  image:
    repository: quay.io/konflux-ci/konflux-devprod/devlake-frontend
    tag: 3b095ed861febca92a40260ba36f33926776d6f0
  securityContext: {}
  containerSecurityContext: {}
  basicAuth:
    enabled: false
    autoCreateSecret: true
    secretName: ""

service:
  type: ClusterIP

ingress:
  enabled: false

option:
  autoCreateSecret: false
  database: mysql
  connectionSecretName: "konflux-devlake-secrets"

extraResources:
  - apiVersion: route.openshift.io/v1
    kind: Route
    metadata:
      name: konflux-devlake-ui
    spec:
      to:
        kind: Service
        name: konflux-devlake-ui
        weight: 100
      port:
        targetPort: ui
      tls:
        termination: edge
        insecureEdgeTerminationPolicy: Redirect
      wildcardPolicy: None
